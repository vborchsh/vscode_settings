{
  "version": "2.0.0",

  "inputs" : [
    {
      "id" : "gui-selection-string",
      "type" : "pickString",
      "description" : "Should this run with GUI?: ",
      "options": ["0", "1"],
      "default": ""
    },
    {
      "id": "questa-selection-string",
      "type": "pickString",
      "description": "Choose QuestaSim command for run: ",
      "options": [
        "-batch -do \"do ${file} sim; run -all;\" # noGUI",
        "-do \"do ${file} sim;\" # GUI",
      ],
      "default": ""
    },
    {
      "id": "pytest-sel-test",
      "type": "command",
      "command": "shellCommand.execute",
      "args": {
          // Collect list of tests | cut last line with `Result (X sec)` | keep file and test name only with no path
          "command": "pytest --collect-only --disable-warnings --quiet ${file} | head -n -1 | xargs -I {} basename {}",
          "fieldSeparator": "\n",
          "description": "Select available pytest test in the open file"
      }
    },
  ],

  "tasks": [
    {
      "label": "QuestaSim: build current file (SV)",
      "type": "shell",
      "command": "vlog -sv ${file}",
      "group": {
        "kind": "build",
      },
      "presentation": {
        "reveal": "silent",
        "clear": true,
        "revealProblems": "onProblem",
        "showReuseMessage": false,
        "focus": false,
      },
      "problemMatcher": {
        "owner": "Verilog",
        "fileLocation": ["autoDetect", "${workspaceFolder}"],
        "pattern": [
          {
            "regexp": "^\\*\\* (Warning|Warning \\(downgraded\\)|Error|Error \\(suppressible\\)): (.*)\\((\\d+)\\): (.*$)",
            "file": 2,
            "line": 3,
            "severity": 1,
            "message": 4,
          },
        ]
      },
    },

    {
      "label": "QuestaSim: run current file (TCL/DO)",
      "type": "shell",
      "command": "vsim ${input:questa-selection-string}",
      "options": {
        "cwd": "${fileDirname}",
        "env": {
          "MTI_VCO_MODE": "64",
        },
      },
      "group": {
        "kind": "build",
      },
      "presentation": {
        "reveal": "silent",
        "clear": true,
        "revealProblems": "onProblem",
        "showReuseMessage": false,
        "focus": false,
      },
      "problemMatcher": {
        "owner": "Verilog",
        "fileLocation": ["autoDetect", "${workspaceFolder}"],
        "pattern": [
          {
            "regexp": "^\\*\\* (Warning|Warning \\(downgraded\\)|Error|Error \\(suppressible\\)): (.*)\\((\\d+)\\): (.*$)",
            "file": 2,
            "line": 3,
            "severity": 1,
            "message": 4,
          },
        ]
      },
    },

    {
      "label": "Pytest: choose and run test from file",
      "type": "shell",
      "command": "python",
      "args": ["-m", "pytest", "-n0", "-s", "${input:pytest-sel-test}"],
      "options": {
        "cwd": "${fileDirname}",
        "env": {
          "GUI": "${input:gui-selection-string}",
          "MTI_VCO_MODE": "64",
        },
      },
      "group": {
        "kind": "build",
      },
      "presentation": {
        "reveal": "silent",
        "clear": true,
        "revealProblems": "onProblem",
        "showReuseMessage": false,
        "focus": false,
      },
      "problemMatcher": [
        {
          "owner": "Verilog",
          "fileLocation": ["autoDetect", "${workspaceFolder}"],
          "pattern": [
            {
              "regexp": "^\\*\\* (Warning|Warning \\(downgraded\\)|Error|Error \\(suppressible\\)): (.*)\\((\\d+)\\): (.*$)",
              "file": 2,
              "line": 3,
              "severity": 1,
              "message": 4,
            },
          ]
        },
        "$python",
      ],
    },

  ],
}